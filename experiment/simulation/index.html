<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> To design a regulated power supply</title>

    <!--Knob CSS-->
    <link rel="stylesheet" href="css/ui.css" />
    <link rel="stylesheet" href="css/style1.css">
    <link rel="stylesheet" href="css/p1.css">

    <!--Knob JS-->
    <script src="js/Knob.js"></script>
    <script src="js/ui.js"></script>
    <script type="text/javascript" src="js/knob1.js"></script>
    <script type="text/javascript" src="js/p1.js"></script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!--JSplumb CSS-->
    <link rel="stylesheet" href="css\jsplumbtoolkit-defaults.css">

    <!--JSplumb JS-->
    <script src="js\jsplumb.min.js"></script>
    <script src="js\jquery-latest.js"></script>
    <script src="js\jquery-ui-latest.js"></script>
    <script src="js\jquery.jsPlumb-1.3.9-all-min.js"></script>


    <!--jQuery-->
    <script src="js\jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

    <!--Display JS-->
    <script src="js\excanvas.js"></script>
    <script src="js\segment-display.js"></script>

    <!--JS files-->
    <script src="js/index.js"></script>
    <script src="js/graph.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <script src="js/dataset1.js"></script>


    <!--CSS files-->
    <link rel="stylesheet" href="css/style.css">

    <style>
        .ui-knob {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 50px;
            background-color: #3c8dbc;
            /* center the div */
            top: 50%;
            left: 50%;
        }

        .ui-indicator {
            position: absolute;
            /* Due to a display bug with anti-aliasing */
            border: 1px solid #808080;
            background-color: #f2f2f2;
        }

        .rotate.ui-indicator {
            height: 10px;
            width: 10px;
            margin-top: 1px;
            margin-left: 1px;
            border-radius: 50%;
        }

        .position-rotate.ui-indicator {
            height: 10px;
            width: 10px;
            margin-top: 23px;
            margin-left: 18px;
            border-radius: 50%;
        }

        #stopbutton {
            border: 4px solid rgb(153, 141, 141);
            padding: 3px;
            border-radius: 2px;
        }
        .scale1{
            display: none;
        }
        .column{
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
    </style>

</head>

<body>


    <div id="exp-name">
        <!-- <h3> To design a regulated power supply</h3> -->
    </div>
    <div id="simulation">
        <div class="left">

            <div id="mid">


                <div>


                    <div id="mydiv"
                        style="padding-left:5px; padding-right: 5px; padding-top: 7px; padding-bottom: 7px; visibility: visible; z-index:10;">

                        <div id="myPlot" style="    width: 553px;
                        height: 355px;
                        z-index: 2;
                        position: absolute;
                        left: -72px;
                        top: -26px;"></div>

                        <img src="images\CROscreen.png" width="400" height="250" id="img"
                            style="position: absolute;filter: brightness(60%); z-index: 1;background-color: #32a836;">

                        <div id="knobs"
                            style=" width: 420px; height: 230px; position: absolute; left: 410px;  z-index: 1;">
                            
                            <ul class="row" style="top: 0px;">
                                <li class="column">
                                    <code style="font-weight: bolder;
                                    font-size: larger;">
                                        CH1
                                    </code>
                                </li>
                                <li class="column">
                                    <input class="preset1" type="range" id="ch1" min="-6" max="6" data-width="95"
                                        data-height="95" data-angleOffset="220" data-angleRange="280" step="2" />

                                    <code style="font-weight: bolder;">mV/div&nbsp;&nbsp;V/div</code>

                                </li>
                                <li class="column">
                                    <input class="preset1" type="range" min="0" max="5" id="time1" value="0"
                                        data-width="95" data-height="95" data-angleOffset="220" data-angleRange="280"
                                        step="1" />
                                    <code style="font-weight: bolder;">TIME(ms/div)</code>

                                </li>
                                <li class="column"> 
                                    <input class="preset1" type="range" id="Y-shift-1" min="-4" max="4" value="0" data-width="75"
                                    data-height="75" data-angleOffset="90" data-angleRange="360" step="1"  data-rotationcircle="yes" />
                                    <code style="font-weight: bolder; ">Y-Shift</code>
                                </li>
                                <li class="column">
                                    <input class="preset1" type="range" id="X-shift-1" min="-4" max="4" value="0" data-width="75"
                                    data-height="75" data-angleOffset="90" data-angleRange="360" step="1" data-rotationcircle="yes" />
                                    <code style="font-weight: bolder; ">X-Shift</code>
                                </li>
                            </ul>
                            
                                
                            <ul class="row" style="top: 138px;
                            left: -21px;">
                                <li class="column" style="    position: relative;
                                left: 77px;
                                top: -9px;">
                                    <code style="font-weight: bolder;
                                    font-size: larger;">
                                        CH2
                                    </code>
                                </li>
                                <li class="column" style="position: relative;
                                left: 10px;"> 
                                    <input class="preset1" type="range" id="Y-shift-2" min="-5" max="5" value="0" data-width="75"
                                    data-height="75" data-angleOffset="90" data-angleRange="360" step="1" data-rotationcircle="yes" />
                                    <code style="font-weight: bolder; ">Y-Shift</code>
                                </li>
                                <li class="column" style="position: relative;
                                left: -55px;">
                                    <input class="preset1" type="range" id="X-shift-2" min="-4" max="4" value="0" data-width="75"
                                    data-height="75" data-angleOffset="90" data-angleRange="360" step="1"  data-rotationcircle="yes"/>
                                    <code style="font-weight: bolder; ">X-Shift</code>
                                </li>
                            </ul>
                            <input type="hidden" id="channel" name="channel" value="">
                        </div>


                        <svg>
                            <filter id="dropshadow" height="150%" width="150%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="2" />
                                <feOffset dx="0" dy="3" result="offsetblur" />
                                <feMerge>
                                    <feMergeNode />
                                    <feMergeNode in="SourceGraphic" />
                                </feMerge>
                            </filter>
                        </svg>
                    </div>

                </div>




                <div id="supply"></div>

                <div id="cro"></div>


                <br />
                <br />
                <br />
                <br />
                <br />


                <div id="board" class="float-container">
                    <div id="trfm" class="float-child">
                        <div id="trfm1"></div>
                        <div id="trfmpins"></div>
                    </div>
                    <div id="knb">
                        <div id="mydiv2" style="margin-top: 60px; visibility: visible; z-index:10;">
                            <div id="knobs2">
                                <input class="preset1" type="range" id="ch3" min="0" max="20" data-width="70"
                                    data-height="80" data-angleOffset="40" data-angleRange="270" step="5" />

                            </div>

                            <svg>
                                <filter id="dropshadow" height="150%" width="150%">
                                    <feGaussianBlur in="SourceAlpha" stdDeviation="2" />
                                    <feOffset dx="0" dy="3" result="offsetblur" />
                                    <feMerge>
                                        <feMergeNode />
                                        <feMergeNode in="SourceGraphic" />
                                    </feMerge>
                                </filter>
                            </svg>
                        </div>
                    </div>

                    <div id="diode1" class="float-child"></div>
                    <div id="diode2" class="float-child"></div>
                    <div id="diode3" class="float-child"></div>
                    <div id="diode4" class="float-child"></div>
                    <div id="d1"><b>D<sub>1</sub></b></div>
                    <div id="d2"><b>D<sub>2</sub></b></div>
                    <div id="d3"><b>D<sub>3</sub></b></div>
                    <div id="d4"><b>D<sub>4</sub></b></div>
                    <div id="c1" class="float-child"></div>
                    <div id="r1" class="float-child"></div>
                    <!-- <div id="c2" class="float-child"></div> -->
                    <div id="v_reg" class="float-child"></div>
                    <div id="led" class="float-child"></div>
                    <!-- <b style="margin-left: 145px;" id="trfm-text">Transformer </b> -->
                    <div id="board_plus"><b>+</b></div>
                    <div id="board_minus"><b>-</b></div>
                    <div id="trfm_label1"><b>A</b></div>
                    <div id="trfm_label2"><b>B</b></div>
                    <div id="trfm_label3"><b>C</b></div>
                    <div id="trfm_label4"><b>D</b></div>
                    <div id="trfm_labelplus"><b>T<sub>+</sub></b></div>
                    <div id="trfm_labelminus"><b>T<sub>-</sub></b></div>
                    <div id="op_plus"><b>O/p<sub>+</sub></b></div>
                    <div id="op_minus"><b>O/p<sub>-</sub></b></div>
                    <div id="c1_label">C<sub>1</sub>&nbsp;&nbsp;C<sub>2</sub></div>
                    <div id="vreg_label">I&nbsp;G&nbsp;O</div>
                    <div id="r11_label">R<sub>1</sub></div>
                    <div id="r12_label">R<sub>2</sub></div>
                    <!-- <div id="c2_label">C<sub>3</sub>&nbsp;&nbsp;C<sub>4</sub></div> -->
                    <div id="led_label">L<sub>1</sub>&nbsp;&nbsp;L<sub>2</sub></div>
                </div>




            </div>

            <div class="bottom">
                <div>
                    <button id="check" onclick="checkCircuit()">Check Connection</button>
                    <button id="reset" onclick="reload()">Reset</button>
                </div>
            </div>
        </div>

        <div class="right" id="right_tab">
            <div class="Button-data" id="First_Data">
                <div class="panel" style="padding-top:20px;">
                    <div class="corner">
                        <button class="close-btn" id="close-btn"><span>&#10005</span></button>
                    </div>
                    <ol type="1" style="padding-left: 20px;padding-top:0px;text-align: left;">
                        <li>Click on the <b>Component</b> button to place components on the breadboard.</li>
                        <li>Make connections as per the table given below.</li>
                        <figure>
                            <img src="./images/table.png" style="height: 320px; width: 320px; margin-left: 30px;">
                        </figure>
                        <li>Click on <b>Check Connection</b> button. If connections are right, click on <b>‘OK’</b>, then Simulation
                            will become active.</li>
                        <li>Observe capacitor filter and DC waveform on C.R.O by adjusting C.R.O channel <b>CH<sub>1</sub>/CH<sub>2</sub></b> and <b>TIME</b> knobs.</li>
                        <li>Use <b>X</b> Shift and <b>Y</b> Shift knobs for wave shifting.</li>
                        <li>Click on the <b>Reset</b> button to reset the webpage.</li>
                    </ol>

                </div>
            </div>


            <div>
                <button class="right_btn" id="First">Instructions</button>

            </div>


            <div class="Components">

                <button class="right_btn" id="second">Components</button>

                <div>
                    <button onclick="breadboard()">Breadboard</button>
                    <button onclick="supply()">Supply</button>
                </div>
                <div>
                    <button style="height: 46px;" onclick="diode1(), diode2(), diode3(), diode4()">Bridge Rectifier</button>
                    <button style="height: 46px;" onclick="c1()">1000&nbsp;µF Capacitor</button>
                </div>
                <div>
                    <button style="height: 46px;" onclick="trfm()">Step Down Transformer</button>
                    <button style="height: 46px;" onclick="r1()">1K&#8486; Resistor</button>
                </div>
                <div>
                    <button onclick="v_reg()">IC 7812</button>
                    <button onclick="led()">LED</button>
                </div>
                <div>
                    <button onclick="cro()">CRO</button>
                </div>
            </div>

        </div>

        <div class="right" id="obsTable">
            <div>
                <button class="right_btn" id="First">Observation Table</button>
            </div>

            <div class="Components2">
                <table>
                    <thead>
                        <th>S.No.</th>
                        <th>Input Voltage (V) </th>
                        <th>Capacitance (µF) </th>
                        <th>Resistance (KΩ) </th>
                        <th>Output Voltage (V)</th>
                        </thead>
                    <tbody>
                        <tr>
                            <td>1.</td>
                            <td>230</td>
                            <td>1000</td>
                            <td>1</td>
                            <td id="freq1">12</td>
                            </tr>
                       
                    </tbody>

                </table>
            </div>


        </div>
    </div>
    <div id="copyright">
        <h5>&copy; Copyright 2022 | Virtual Labs IIT Roorkee</h5>
    </div>


    <!--CRO Codes-->

    <script type="text/javascript">
        makeGraph();
        function makeGraph(){
            let changeY1=parseFloat(document.getElementById("Y-shift-1").value);
            let changeX1=parseFloat(document.getElementById("X-shift-1").value)*0.0015;
            let changeY2=parseFloat(document.getElementById("Y-shift-2").value);
            let changeX2=parseFloat(document.getElementById("X-shift-2").value)*0.0015;
            let ch1=parseInt(document.getElementById("ch1").value);
            let datasets = [dataset1];
            let time=parseFloat(document.getElementById("time1").value);

        let selectedDatasetIndex = 0;
        console.log(time)
        const xValues=[];
        const yValues =[];
        const dcValue=[];
        const MainX=[];
        var maxX=time*0.012;
        var maxY=14.38;
        var flag=false;
        if(ch1<0){
            flag=true;
            ch1=ch1*-0.5;
        }else{
            flag=false;
        }

        const selectedDataset = datasets[selectedDatasetIndex];
        for (let i of selectedDataset){
            if(flag){
                yValues.push(i.y+(changeY1/6)*ch1-15.5);
                dcValue.push(0+changeY2-(ch1/2));
                xValues.push(i.x+changeX1-0.01);
                MainX.push(i.x+changeX2);
            }else{

                yValues.push(i.y+(changeY1/6)*ch1-15.5);
                dcValue.push(0+changeY2-ch1);
                xValues.push(i.x+changeX1-0.01);
                MainX.push(i.x+changeX2);
            }

        }
       

        // const xValues = selectedDataset.map((item) => (item.x+changeX));
        // const yValues = selectedDataset.map((item) => item.y+changeY);
var color_gradient="rgb(0, 233, 0)";
        const trace = {
            x: xValues,
            y: yValues,
            mode: "lines",
            marker: { color: color_gradient },
            line: {
                width: 4
            }

        };
        const traceDC={
            x: MainX,
            y: dcValue,
            mode: "lines",
            marker: { color: color_gradient },
            line: {
                width: 4
            }
        }
        const default_trace={
            x: [-1,0,1],
            y: [0,0,0],
            mode: "lines",
            marker: { color: color_gradient },
            line: {
                width: 4
            }
        }

        const data = [trace,traceDC];
        
        if (flag){
            maxY=ch1

        }else{
            maxY=ch1*2;
        }
        const layout = {
           xaxis: { range: [0,maxX ],showgrid: false, zeroline: false, visible: false, fixedrange: true },
           yaxis: { range: [-1*maxY,maxY*0.5],showgrid: false, zeroline: false, visible: false, fixedrange: true },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            hovermode: false,
            margin: {
                t: 40,
            },showlegend: false,
        };

        config = {
            displayModeBar: false
        }
        if(ch1!=0 && time!=0){

            Plotly.newPlot("myPlot", data, layout, config);
        }else{
            Plotly.newPlot("myPlot", [default_trace], {
           xaxis: { range: [-0.2,0.2 ],showgrid: false, zeroline: false, visible: false, fixedrange: true },
           yaxis: { range: [-2,2],showgrid: false, zeroline: false, visible: false, fixedrange: true },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            hovermode: false,
            margin: {
                t: 40,
            },showlegend: false,
        }, config);

        }

        }


        


        
    </script>

    <script type="text/javascript">
        for (var i = 1; i < 3; i++) {
            Array.prototype.slice.call(document.getElementsByClassName('preset' + i)).forEach(function (el) {
                new Knob1(el, new Ui['P' + i]());
                el.addEventListener('change', function () {
                    
                    makeGraph();
                })
            })
        }
        [document.getElementById('rotate'),document.getElementById('position-rotate')].forEach((el)=>{
            new Knob(el,new Ui['P1']());
            el.addEventListener('change',()=>{
                makeGraph();
            });
        })
        


        var Arcxample = function () { };

        Arcxample.prototype = Object.create(Ui.prototype);

        Arcxample.prototype.createElement = function () {

            Ui.prototype.createElement.apply(this, arguments);
            this.addComponent(new Ui.Arc({
                arcWidth: this.width / 10
            }));
            this.el.node.setAttribute("class", "arcExample");
        };
        new Knob1(document.getElementsByClassName('arcExample')[0], new Arcxample());
    </script>
    <script type="text/javascript">
        var createKnobCSS = function (knob, id) {
            var $input = $(knob.element),
                $container = $('<div class="container ' + id + '">'),

                $body = $('<div class="ui-knob  ' + id + '">'),
                $indicator = $('<div class="ui-indicator ' + id + '">');

            $container.append($body);
            $container.append($indicator);

            // $input.hide();
            $container.insertBefore($input);
            $container.append($input);

            $body.css({
                "margin-top": -($body.outerHeight() / 2),
                "margin-left": -($body.outerWidth() / 2)
            });

            setupKnob(knob, $container[0]);

        }


        var drawKnobCSS = function (knob, indicator) {
            var $indicator = $(knob.element).siblings('.ui-indicator');
            $indicator.css({
                left: indicator.x - $indicator.outerWidth() / 2,
                top: indicator.y - $indicator.outerHeight() / 2
            });


        }
        var positionRotateKnob = new Knob(document.getElementById('position-rotate'),
            function (knob, indicator) {
                drawKnobCSS(knob, indicator);
            }
        );
        createKnobCSS(positionRotateKnob, 'position-rotate');
    </script>
    <script type="text/javascript">
        var createKnobCSS = function (knob, id) {
            var $input = $(knob.element),
                $container1 = $('<div class="container1 ' + id + '">'),

                $body = $('<div class="ui-knob  ' + id + '">'),
                $indicator = $('<div class="ui-indicator ' + id + '">');

            $container1.append($body);
            $container1.append($indicator);

            // $input.hide();
            $container1.insertBefore($input);
            $container1.append($input);

            $body.css({
                "margin-top": -($body.outerHeight() / 2),
                "margin-left": -($body.outerWidth() / 2)
            });

            setupKnob(knob, $container1[0]);

        }


        var drawKnobCSS = function (knob, indicator) {
            var $indicator = $(knob.element).siblings('.ui-indicator');
            $indicator.css({
                left: indicator.x - $indicator.outerWidth() / 2,
                top: indicator.y - $indicator.outerHeight() / 2
            });


        }

        var rotateKnob = new Knob(document.getElementById('rotate'),
            function (knob, indicator) {
                drawKnobCSS(knob, indicator);
            }
        );
        createKnobCSS(rotateKnob, 'rotate');
    </script>

    <!--CRO Codes end-->

    <script src="js/right_components.js"></script>

</body>

</html>